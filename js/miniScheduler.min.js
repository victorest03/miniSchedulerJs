"use strict";var drag,drop,allowDrop;$.fn.extend({miniSheduler:function(n){function t(n){o=a(n);var t="";t+=d.info.monthNamesShort[o[0].getMonth()]+" ",t+=("00"+o[0].getDate()).substr(-2,2)+" ",o[0].getFullYear()!==o[o.length-1].getFullYear()&&(t+=", "+o[0].getFullYear()+" "),t+="- ",o[0].getMonth()!==o[o.length-1].getMonth()&&(t+=d.info.monthNamesShort[o[o.length-1].getMonth()]+" "),t+=("00"+o[o.length-1].getDate()).substr(-2,2)+" ",t+=", "+o[o.length-1].getFullYear()+" ",h.find("th.mns-year>.mns-year-content").html(t);var e=159*o.length+1;b.find(".mns-content").css({"min-width":e}),g.find(".mns-content").css({"min-width":e}),b.find(".mns-content>table>colgroup").html(""),b.find(".mns-content>table>thead>tr:eq(0)").html(""),g.find(".mns-content>.mns-rows colgroup").html("");for(var s=100/o.length,r=0;r<o.length;r++)b.find(".mns-content>table>colgroup").append('<col style="width: '+s+'%">'),b.find(".mns-content>table>thead>tr:eq(0)").append('<th class="mns-days">\n                                                                                            <div class="mns-day"></div>\n                                                                                        </th>'),g.find(".mns-content>.mns-rows colgroup").append('<col style="width: '+s+'%">');$.each(h.find("th.mns-days"),function(n,e){t=d.info.dayNames[o[n].getDay()]+" "+("00"+o[n].getDate()).substr(-2,2)+"/"+d.info.monthNamesShort[o[n].getMonth()],$(e).find(".mns-day").html(t)})}function e(){u.find("table>tbody").html(""),g.find("table>tbody").html(""),$.each(i,function(n,t){var e=$("<tr>");u.find("table>tbody").append('<tr>\n                                                                        <td>\n                                                                            <div class="mns-row mns-area-row-'+n+'">\n                                                                                '+t.name+"\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>");for(var a=0;a<o.length;a++){var s,r;!function(a){s=$("<td>"),r=$('<div class="mns-row mns-area-row-'+n+'" ondrop="drop(event)" ondragover="allowDrop(event)">'),$.each(t.data,function(t,e){o[a].getDate()===e.date.getDate()&&o[a].getMonth()===e.date.getMonth()&&o[a].getFullYear()===e.date.getFullYear()&&r.append("<div class='time-area-item' id='time-area-item-"+n+"-"+a+"' draggable='true' ondragstart=\"drag(event)\">"+e.info+"</div>")}),s.append(r),e.append(s)}(a)}g.find("table>tbody").append(e)}),s()}function a(n){var t,e=[],a=n?new Date(n):new Date(new Date);if("month"===r)t=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),1!==a.getDate()&&a.setDate(1);else{t=7;var s=a.getDay()||7;1!==s&&a.setHours(-24*(s-1))}for(var o=0;o<t;o++)e[o]=0===o?new Date(a):new Date(a.setHours(24));return e}function s(){$.each(g.find("table>tbody>tr"),function(n,t){var e=0;$("td>.mns-area-row-"+n).css("height","auto"),$.each($("td>.mns-area-row-"+n),function(n,t){e<$(t).height()&&(e=$(t).height())}),$("td>.mns-area-row-"+n).height(e)})}var o,r,i=[],d={mode:"week",info:{monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],dayNamesMin:["D","L","M","X","J","V","S"]}},l=$(this).addClass("miniSheduler"),c=$('<div class="mns-toolbar">\n                                    <div class="mns-left">\n                                        <button type="button" class="mns-btn btnToday">Hoy</button>\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnAfterWeek"><i class="mns-arrow-left"></i></button>\n                                            <button type="button" class="mns-btn btnBeforeWeek"><i class="mns-arrow-right"></i></button>\n                                        </div>\n                                    </div>\n                                    <div class="mns-center"></div>\n                                    <div class="mns-right">\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnChangeView btnWeekViewMode active">Semana</button>\n                                            <button type="button" class="mns-btn btnChangeView btnMonthViewMode">Mes</button>\n                                        </div>\n                                    </div>\n                                </div>').appendTo(l),m=$('<div class="mns-container">\n                                    <div class="mns-container-view mns-timelineWeek mns-timeline">\n                                        <table class="table table-bordered">\n                                        <colgroup>\n                                            <col>\n                                            <col>\n                                            <col>\n                                        </colgroup>\n                                        <thead class="mns-head">\n                                        <tr>\n                                            <th class="mns-resource-area">\n                                                <i class="fa fa-user" aria-hidden="true"></i> Tecnico\n                                            </th>\n                                            <th class="mns-divider mns-col-resizer"></th>\n                                            <th class="mns-time-area">\n                                                <table class="table table-bordered">\n                                                    <thead>\n                                                    <tr>\n                                                        <th class="mns-year">\n                                                            <div class="mns-year-content"></div>\n                                                        </th>\n                                                    </tr>\n                                                    </thead>\n                                                </table>\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <table class="table table-bordered">\n                                                                <colgroup></colgroup>\n                                                                <thead><tr></tr></thead>\n                                                            </table>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </th>\n                                        </tr>\n                                        </thead>\n                                        <tbody class="mns-body">\n                                        <tr>\n                                            <td class="mns-resource-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                            <td class="mns-divider mns-col-resizer"></td>\n                                            <td class="mns-time-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <colgroup></colgroup>\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                        </table>\n                                    </div>\n                                </div>').appendTo(l),h=m.find(".mns-head"),b=h.find(".mns-time-area"),v=m.find(".mns-body"),u=v.find(".mns-resource-area"),g=v.find(".mns-time-area");g.find(".mns-scroller").on("scroll",function(){b.find(".mns-scroller").scrollLeft($(this).scrollLeft())}),c.find(".btnToday").on("click",function(){t(),e()}),c.find(".btnBeforeWeek").on("click",function(){var n=o[0];"month"===r?n.setMonth(n.getMonth()+1):n.setDate(n.getDate()+7),t(n),e()}),c.find(".btnAfterWeek").on("click",function(){var n=o[0];"month"===r?n.setMonth(n.getMonth()-1):n.setDate(n.getDate()-7),t(n),e()}),c.find(".btnChangeView").on("click",function(){var n=$(this);c.find(".btnChangeView").removeClass("active"),n.addClass("active"),n.hasClass("btnMonthViewMode")?r="month":n.hasClass("btnWeekViewMode")&&(r="week"),t(),e()}),$("body").on("click",".time-area-item",function(){var n=$(this).attr("id");console.log(i[n.split("-")[3]].data[n.split("-")[4]])}),window.drag=function(n){n.dataTransfer.setData("textID",n.target.id)},window.drop=function(n){n.preventDefault();var t=n.dataTransfer.getData("textID");$(n.target).hasClass("mns-row")?(n.target.appendChild($("#"+t)[0]),s()):$(n.target).parent().hasClass("mns-row")&&($(n.target).parent()[0].appendChild($("#"+t)[0]),s())},window.allowDrop=function(n){n.preventDefault()},r=d.mode,i=n.customData,t(),e()}});