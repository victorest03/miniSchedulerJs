"use strict";var drag,drop,allowDrop;$.fn.extend({miniSheduler:function(t){function n(t){i=s(t);var n="";n+=c.info.monthNamesShort[i[0].getMonth()]+" ",n+=("00"+i[0].getDate()).substr(-2,2)+" ",i[0].getFullYear()!==i[i.length-1].getFullYear()&&(n+=", "+i[0].getFullYear()+" "),n+="- ",i[0].getMonth()!==i[i.length-1].getMonth()&&(n+=c.info.monthNamesShort[i[i.length-1].getMonth()]+" "),n+=("00"+i[i.length-1].getDate()).substr(-2,2)+" ",n+=", "+i[i.length-1].getFullYear()+" ",b.find("th.mns-year>.mns-year-content").html(n);var e=159*i.length+1;u.find(".mns-content").css({"min-width":e}),f.find(".mns-content").css({"min-width":e}),u.find(".mns-content>table>colgroup").html(""),u.find(".mns-content>table>thead>tr:eq(0)").html(""),f.find(".mns-content>.mns-rows colgroup").html("");for(var a=100/i.length,o=0;o<i.length;o++)u.find(".mns-content>table>colgroup").append('<col style="width: '+a+'%">'),u.find(".mns-content>table>thead>tr:eq(0)").append('<th class="mns-days">\n                                                                                            <div class="mns-day"></div>\n                                                                                        </th>'),f.find(".mns-content>.mns-rows colgroup").append('<col style="width: '+a+'%">');$.each(b.find("th.mns-days"),function(t,e){n=c.info.dayNames[i[t].getDay()]+" "+("00"+i[t].getDate()).substr(-2,2)+"/"+c.info.monthNamesShort[i[t].getMonth()],$(e).find(".mns-day").html(n)})}function e(t){$.ajax({url:l+"?start="+i[0].getFullYear()+"-"+(i[0].getMonth()+1)+"-"+i[0].getDate()+"&end="+i[i.length-1].getFullYear()+"-"+(i[i.length-1].getMonth()+1)+"-"+i[i.length-1].getDate()+(t||""),type:"GET",dataType:"json",success:function(t){d=t,a()}})}function a(){p.find("table>tbody").html(""),f.find("table>tbody").html(""),$.each(d,function(t,n){var e=$("<tr>");p.find("table>tbody").append('<tr>\n                                                                        <td>\n                                                                            <div class="mns-row mns-area-row-'+t+'">\n                                                                                '+n.name+"\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>");for(var a=0;a<i.length;a++){var s,o;!function(a){s=$("<td>"),o=$('<div class="mns-row mns-area-row-'+t+'" '+(c.draggable?'ondrop="drop(event)" ondragover="allowDrop(event)"':"")+">"),$.each(n.data,function(n,e){var s=new Date(e.date);i[a].getDate()===s.getDate()&&i[a].getMonth()===s.getMonth()&&i[a].getFullYear()===s.getFullYear()&&o.append("<div class='time-area-item' id='time-area-item-"+t+"-"+n+"' "+(e.background?'style="background: '+e.background+';"':"")+" "+(c.draggable?'draggable="true" ondragstart="drag(event)"':"")+">"+e.info+"</div>")}),s.append(o),n.footer&&$.each(n.footer,function(t,n){var e=new Date(n.date);if(i[a].getDate()===e.getDate()&&i[a].getMonth()===e.getMonth()&&i[a].getFullYear()===e.getFullYear()){var o=$('<div class="mns-row-pie">'+n.contend+"</div>");n.background&&o.css({background:n.background}),n.color&&o.css({color:n.color}),s.append(o)}}),e.append(s)}(a)}f.find("table>tbody").append(e)}),o()}function s(t){var n,e=[],a=t?new Date(t):new Date(new Date);if("month"===r)n=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),1!==a.getDate()&&a.setDate(1);else{n=7;var s=a.getDay()||7;1!==s&&a.setHours(-24*(s-1))}for(var o=0;o<n;o++)e[o]=0===o?new Date(a):new Date(a.setHours(24));return e}function o(){$.each(f.find("table>tbody>tr"),function(t,n){var e=0;$("td>.mns-area-row-"+t).css("height","auto"),$.each($("td>.mns-area-row-"+t),function(t,n){e<$(n).parent().height()&&(e=$(n).parent().height()),$(n).css("height",0!==$(n).next(".mns-row-pie").length?"calc(100% - 25px)":"100%")}),$("td>.mns-area-row-"+t).parent().height(e)})}var i,r,l,d=[],c={mode:"week",info:{monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],dayNamesMin:["D","L","M","X","J","V","S"]},draggable:!1},m=$(this).addClass("miniSheduler"),g=$('<div class="mns-toolbar">\n                                    <div class="mns-left">\n                                        <button type="button" class="mns-btn btnToday">Hoy</button>\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnAfterWeek"><i class="mns-arrow-left"></i></button>\n                                            <button type="button" class="mns-btn btnBeforeWeek"><i class="mns-arrow-right"></i></button>\n                                        </div>\n                                    </div>\n                                    <div class="mns-center"></div>\n                                    <div class="mns-right">\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnChangeView btnWeekViewMode active">Semana</button>\n                                            <button type="button" class="mns-btn btnChangeView btnMonthViewMode">Mes</button>\n                                        </div>\n                                    </div>\n                                </div>').appendTo(m),h=$('<div class="mns-container">\n                                    <div class="mns-container-view mns-timelineWeek mns-timeline">\n                                        <table class="table table-bordered">\n                                        <colgroup>\n                                            <col>\n                                            <col>\n                                            <col>\n                                        </colgroup>\n                                        <thead class="mns-head">\n                                        <tr>\n                                            <th class="mns-resource-area">\n                                                <i class="fa fa-user" aria-hidden="true"></i> Tecnico\n                                            </th>\n                                            <th class="mns-divider mns-col-resizer"></th>\n                                            <th class="mns-time-area">\n                                                <table class="table table-bordered">\n                                                    <thead>\n                                                    <tr>\n                                                        <th class="mns-year">\n                                                            <div class="mns-year-content"></div>\n                                                        </th>\n                                                    </tr>\n                                                    </thead>\n                                                </table>\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <table class="table table-bordered">\n                                                                <colgroup></colgroup>\n                                                                <thead><tr></tr></thead>\n                                                            </table>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </th>\n                                        </tr>\n                                        </thead>\n                                        <tbody class="mns-body">\n                                        <tr>\n                                            <td class="mns-resource-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                            <td class="mns-divider mns-col-resizer"></td>\n                                            <td class="mns-time-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <colgroup></colgroup>\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                        </table>\n                                    </div>\n                                </div>').appendTo(m),b=h.find(".mns-head"),u=b.find(".mns-time-area"),v=h.find(".mns-body"),p=v.find(".mns-resource-area"),f=v.find(".mns-time-area"),w=$('<div class=\'mns-tooltip\'>\n                                    <div class="mns-tooltip-arrow"></div>\n                                    <div class="mns-tooltip-body"></div>\n                            </div>').appendTo(m),y=w.find(".mns-tooltip-body"),D=w.find(".mns-tooltip-arrow"),M=$("<div class='mns-loadview'>Cargando...</div>").appendTo(m);return f.find(".mns-scroller").on("scroll",function(){u.find(".mns-scroller").scrollLeft($(this).scrollLeft())}),g.find(".btnToday").on("click",function(){M.toggleClass("active"),n(),e(),a(),M.toggleClass("active")}),g.find(".btnBeforeWeek").on("click",function(){M.toggleClass("active");var t=i[0];"month"===r?t.setMonth(t.getMonth()+1):t.setDate(t.getDate()+7),n(t),e(),a(),M.toggleClass("active")}),g.find(".btnAfterWeek").on("click",function(){M.toggleClass("active");var t=i[0];"month"===r?t.setMonth(t.getMonth()-1):t.setDate(t.getDate()-7),n(t),e(),a(),M.toggleClass("active")}),g.find(".btnChangeView").on("click",function(){var t=$(this);t.hasClass("active")||(M.toggleClass("active"),g.find(".btnChangeView").removeClass("active"),t.addClass("active"),t.hasClass("btnMonthViewMode")?r="month":t.hasClass("btnWeekViewMode")&&(r="week"),n(),e(),a(),M.toggleClass("active"))}),$("body").on("click",".time-area-item",function(){var t=$(this).attr("id"),n=t.split("-")[3],e=t.split("-")[4],a={name:d[n].name,extra:d[n].extra,item:d[n].data[e]};c.onClick&&c.onClick(a)}),$(document).on("mouseenter",".time-area-item",function(t){var n=$(this),e=$(this).attr("id"),a=e.split("-")[3],s=e.split("-")[4],o={name:d[a].name,extra:d[a].extra,item:d[a].data[s]};if(c.tooltip){var i=n.position();w.css({left:i.left+(n.width()-parseInt(c.tooltip.width,10))/2+"px",top:i.top+17+"px"}),D.css({"border-bottom-color":c.tooltip.background}),y.css({width:c.tooltip.width,"font-size":c.tooltip.fontSize,background:c.tooltip.background,color:c.tooltip.color}),y.html(c.tooltip.content(o)),w.toggleClass("active")}}),$(document).on("mouseleave",".time-area-item",function(t){w.toggleClass("active")}),window.drag=function(t){t.dataTransfer.setData("textID",t.target.id)},window.drop=function(t){t.preventDefault();var n=t.dataTransfer.getData("textID");$(t.target).hasClass("mns-row")?(t.target.appendChild($("#"+n)[0]),o()):$(t.target).parent().hasClass("mns-row")&&($(t.target).parent()[0].appendChild($("#"+n)[0]),o())},window.allowDrop=function(t){t.preventDefault()},r=c.mode,n(),t.ajax.data?d=t.ajax.data:t.ajax.url&&0!==t.ajax.url.length&&(l=t.ajax.url,e()),t.icons&&t.icons.arrow&&(g.find("i.mns-arrow-left").attr("class",t.icons.arrow.left),g.find("i.mns-arrow-right").attr("class",t.icons.arrow.right)),c.draggable=t.draggable,c.onClick=t.onClick,c.tooltip=t.tooltip,a(),{destroy:function(){m.html("")},load:{data:function(t){d=t,a()},update:function(t){e(t)}}}}});