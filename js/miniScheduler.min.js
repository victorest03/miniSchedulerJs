"use strict";var drag,drop,allowDrop;$.fn.extend({miniSheduler:function(t){var i,r,n,l=[],d={mode:"week",info:{monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],dayNamesMin:["D","L","M","X","J","V","S"]},draggable:!1},e=$(this).addClass("miniSheduler"),a=$('<div class="mns-toolbar">\n                                    <div class="mns-left">\n                                        <button type="button" class="mns-btn btnToday">Hoy</button>\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnAfterWeek"><i class="mns-arrow-left"></i></button>\n                                            <button type="button" class="mns-btn btnBeforeWeek"><i class="mns-arrow-right"></i></button>\n                                        </div>\n                                    </div>\n                                    <div class="mns-center"></div>\n                                    <div class="mns-right">\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnChangeView btnWeekViewMode active">Semana</button>\n                                            <button type="button" class="mns-btn btnChangeView btnMonthViewMode">Mes</button>\n                                        </div>\n                                    </div>\n                                </div>').appendTo(e),o=$('<div class="mns-container">\n                                    <div class="mns-container-view mns-timelineWeek mns-timeline">\n                                        <table class="table table-bordered">\n                                        <colgroup>\n                                            <col>\n                                            <col>\n                                            <col>\n                                        </colgroup>\n                                        <thead class="mns-head">\n                                        <tr>\n                                            <th class="mns-resource-area">\n                                                <i class="fa fa-user" aria-hidden="true"></i> Tecnico\n                                            </th>\n                                            <th class="mns-divider mns-col-resizer"></th>\n                                            <th class="mns-time-area">\n                                                <table class="table table-bordered">\n                                                    <thead>\n                                                    <tr>\n                                                        <th class="mns-year">\n                                                            <div class="mns-year-content"></div>\n                                                        </th>\n                                                    </tr>\n                                                    </thead>\n                                                </table>\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <table class="table table-bordered">\n                                                                <colgroup></colgroup>\n                                                                <thead><tr></tr></thead>\n                                                            </table>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </th>\n                                        </tr>\n                                        </thead>\n                                        <tbody class="mns-body">\n                                        <tr>\n                                            <td class="mns-resource-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                            <td class="mns-divider mns-col-resizer"></td>\n                                            <td class="mns-time-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <colgroup></colgroup>\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                        </table>\n                                    </div>\n                                </div>').appendTo(e),s=o.find(".mns-head"),c=s.find(".mns-time-area"),m=o.find(".mns-body"),h=m.find(".mns-resource-area"),b=m.find(".mns-time-area"),g=$('<div class=\'mns-tooltip\'>\n                                    <div class="mns-tooltip-arrow"></div>\n                                    <div class="mns-tooltip-body"></div>\n                            </div>').appendTo(e),u=g.find(".mns-tooltip-body"),v=g.find(".mns-tooltip-arrow"),p=$("<div class='mns-loadview'>Cargando...</div>").appendTo(e);function f(t){i=function(t){var n,e=[],a=t?new Date(t):new Date(new Date);if("month"===r)n=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),1!==a.getDate()&&a.setDate(1);else{n=7;var o=a.getDay()||7;1!==o&&a.setHours(-24*(o-1))}for(var s=0;s<n;s++)e[s]=0===s?new Date(a):new Date(a.setHours(24));return e}(t);var e="";e+=d.info.monthNamesShort[i[0].getMonth()]+" ",e+=("00"+i[0].getDate()).substr(-2,2)+" ",i[0].getFullYear()!==i[i.length-1].getFullYear()&&(e+=", "+i[0].getFullYear()+" "),e+="- ",i[0].getMonth()!==i[i.length-1].getMonth()&&(e+=d.info.monthNamesShort[i[i.length-1].getMonth()]+" "),e+=("00"+i[i.length-1].getDate()).substr(-2,2)+" ",e+=", "+i[i.length-1].getFullYear()+" ",s.find("th.mns-year>.mns-year-content").html(e);var n=159*i.length+1;c.find(".mns-content").css({"min-width":n}),b.find(".mns-content").css({"min-width":n}),c.find(".mns-content>table>colgroup").html(""),c.find(".mns-content>table>thead>tr:eq(0)").html(""),b.find(".mns-content>.mns-rows colgroup").html("");for(var a=100/i.length,o=0;o<i.length;o++)c.find(".mns-content>table>colgroup").append('<col style="width: '+a+'%">'),c.find(".mns-content>table>thead>tr:eq(0)").append('<th class="mns-days">\n                                                                                            <div class="mns-day"></div>\n                                                                                        </th>'),b.find(".mns-content>.mns-rows colgroup").append('<col style="width: '+a+'%">');$.each(s.find("th.mns-days"),function(t,n){e=d.info.dayNames[i[t].getDay()]+" "+("00"+i[t].getDate()).substr(-2,2)+"/"+d.info.monthNamesShort[i[t].getMonth()],$(n).find(".mns-day").html(e)})}function w(t){$.ajax({url:n+"?start="+i[0].getFullYear()+"-"+(i[0].getMonth()+1)+"-"+i[0].getDate()+"&end="+i[i.length-1].getFullYear()+"-"+(i[i.length-1].getMonth()+1)+"-"+i[i.length-1].getDate()+(t||""),type:"GET",dataType:"json",success:function(t){l=t,y(),p.removeClass("active")}})}function y(){h.find("table>tbody").html(""),b.find("table>tbody").html(""),$.each(l,function(a,t){var n=$("<tr>");h.find("table>tbody").append('<tr>\n                                                                        <td>\n                                                                            <div class="mns-row mns-area-row-'+a+'">\n                                                                                '+t.name+"\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>");for(var e=function(o){s=$("<td>"),r=$('<div class="mns-row mns-area-row-'+a+'" '+(d.draggable?'ondrop="drop(event)" ondragover="allowDrop(event)"':"")+">"),$.each(t.data,function(t,n){var e=new Date(n.date);i[o].getDate()===e.getDate()&&i[o].getMonth()===e.getMonth()&&i[o].getFullYear()===e.getFullYear()&&r.append("<div class='time-area-item' id='time-area-item-"+a+"-"+t+"' "+(n.background||n.color?'style="'+(n.background?"background: "+n.background+";":"")+(n.color?"color: "+n.color+";":"")+'"':"")+" "+(d.draggable?'draggable="true" ondragstart="drag(event)"':"")+">"+n.info+"</div>")}),s.append(r),t.footer&&$.each(t.footer,function(t,n){var e=new Date(n.date);if(i[o].getDate()===e.getDate()&&i[o].getMonth()===e.getMonth()&&i[o].getFullYear()===e.getFullYear()){var a=$('<div class="mns-row-pie">'+n.contend+"</div>");n.background&&a.css({background:n.background}),n.color&&a.css({color:n.color}),s.append(a)}}),n.append(s)},o=0;o<i.length;o++){var s,r;e(o)}b.find("table>tbody").append(n)}),D()}function D(){$.each(b.find("table>tbody>tr"),function(t,n){var e=0;$("td>.mns-area-row-"+t).css("height","auto"),$.each($("td>.mns-area-row-"+t),function(t,n){e<$(n).parent().height()&&(e=$(n).parent().height()),$(n).css("height",0!==$(n).next(".mns-row-pie").length?"calc(100% - 25px)":"100%")}),$("td>.mns-area-row-"+t).parent().height(e)})}return b.find(".mns-scroller").on("scroll",function(){c.find(".mns-scroller").scrollLeft($(this).scrollLeft())}),a.find(".btnToday").on("click",function(){p.addClass("active"),f(),w(),y()}),a.find(".btnBeforeWeek").on("click",function(){p.addClass("active");var t=i[0];"month"===r?t.setMonth(t.getMonth()+1):t.setDate(t.getDate()+7),f(t),w(),y()}),a.find(".btnAfterWeek").on("click",function(){p.addClass("active");var t=i[0];"month"===r?t.setMonth(t.getMonth()-1):t.setDate(t.getDate()-7),f(t),w(),y()}),a.find(".btnChangeView").on("click",function(){var t=$(this);t.hasClass("active")||(p.addClass("active"),a.find(".btnChangeView").removeClass("active"),t.addClass("active"),t.hasClass("btnMonthViewMode")?r="month":t.hasClass("btnWeekViewMode")&&(r="week"),f(),w())}),$("body").on("click",".time-area-item",function(){var t=$(this).attr("id"),n=t.split("-")[3],e=t.split("-")[4],a={name:l[n].name,extra:l[n].extra,item:l[n].data[e]};d.onClick&&d.onClick(a)}),$(document).on("mouseenter",".time-area-item",function(t){g.removeClass("active");var n=$(this),e=$(this).attr("id"),a=e.split("-")[3],o=e.split("-")[4],s={name:l[a].name,extra:l[a].extra,item:l[a].data[o]};if(d.tooltip){var r=n.position();g.css({left:r.left+(n.width()-parseInt(d.tooltip.width,10))/2+"px",top:r.top+17+"px"}),v.css({"border-bottom-color":d.tooltip.background}),u.css({width:d.tooltip.width,"font-size":d.tooltip.fontSize,background:d.tooltip.background,color:d.tooltip.color}),u.html(d.tooltip.content(s)),g.addClass("active")}}),$(document).on("mouseleave",".time-area-item",function(t){g.removeClass("active")}),window.drag=function(t){t.dataTransfer.setData("textID",t.target.id)},window.drop=function(t){t.preventDefault();var n=t.dataTransfer.getData("textID");$(t.target).hasClass("mns-row")?(t.target.appendChild($("#"+n)[0]),D()):$(t.target).parent().hasClass("mns-row")&&($(t.target).parent()[0].appendChild($("#"+n)[0]),D())},window.allowDrop=function(t){t.preventDefault()},p.addClass("active"),r=d.mode,f(),t.ajax.data?l=t.ajax.data:t.ajax.url&&0!==t.ajax.url.length&&(n=t.ajax.url,w()),t.icons&&t.icons.arrow&&(a.find("i.mns-arrow-left").attr("class",t.icons.arrow.left),a.find("i.mns-arrow-right").attr("class",t.icons.arrow.right)),d.draggable=t.draggable,d.onClick=t.onClick,d.tooltip=t.tooltip,{destroy:function(){e.html("")},load:{data:function(t){l=t,y()},update:function(t){w(t)}}}}});