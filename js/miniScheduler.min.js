"use strict";var drag,drop,allowDrop;$(function(){function e(e){o=n(e);var t="";t+=g.info.monthNamesShort[o[0].getMonth()]+" ",t+=("00"+o[0].getDate()).substr(-2,2)+" ",o[0].getFullYear()!==o[o.length-1].getFullYear()&&(t+=", "+o[0].getFullYear()+" "),t+="- ",o[0].getMonth()!==o[o.length-1].getMonth()&&(t+=g.info.monthNamesShort[o[o.length-1].getMonth()]+" "),t+=("00"+o[o.length-1].getDate()).substr(-2,2)+" ",t+=", "+o[o.length-1].getFullYear()+" ",d.find("th.mns-year>.mns-year-content").html(t);var a=159*o.length+1;l.find(".mns-content").css({"min-width":a}),h.find(".mns-content").css({"min-width":a}),l.find(".mns-content>table>colgroup").html(""),l.find(".mns-content>table>thead>tr:eq(0)").html(""),h.find(".mns-content>.mns-rows colgroup").html("");for(var r=100/o.length,i=0;i<o.length;i++)l.find(".mns-content>table>colgroup").append('<col style="width: '+r+'%">'),l.find(".mns-content>table>thead>tr:eq(0)").append('<th class="mns-days">\n                                                                                        <div class="mns-day"></div>\n                                                                                    </th>'),h.find(".mns-content>.mns-rows colgroup").append('<col style="width: '+r+'%">');$.each(d.find("th.mns-days"),function(e,n){t=g.info.dayNames[o[e].getDay()]+" "+("00"+o[e].getDate()).substr(-2,2)+"/"+g.info.monthNamesShort[o[e].getMonth()],$(n).find(".mns-day").html(t)})}function t(){c.find("table>tbody").html(""),h.find("table>tbody").html(""),$.each(f,function(e,t){var n=$("<tr>");c.find("table>tbody").append('<tr>\n                                                                    <td>\n                                                                        <div class="mns-row mns-area-row-'+e+'">\n                                                                            '+t.name+"\n                                                                        </div>\n                                                                    </td>\n                                                                </tr>");for(var a=0;a<l.find(".mns-content th.mns-days").length;a++){var o,i;!function(a){o=$("<td>"),i=$('<div class="mns-row mns-area-row-'+e+'" ondrop="drop(event)" ondragover="allowDrop(event)">'),$.each(t.data,function(t,n){("month"===r&&n.date.getDate()-1===a||"week"===r&&(0===n.date.getDay()?7:n.date.getDay())-1===a)&&i.append("<div class='time-area-item' id='time-area-item-"+e+"-"+a+"' draggable='true' ondragstart=\"drag(event)\">"+n.info+"</div>")}),o.append(i),n.append(o)}(a)}h.find("table>tbody").append(n)}),a()}function n(e){var t,n=[],a=e?new Date(e):new Date(new Date);if("month"===r)t=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),1!==a.getDate()&&a.setDate(1);else{t=7;var o=a.getDay()||7;1!==o&&a.setHours(-24*(o-1))}for(var i=0;i<t;i++)n[i]=0===i?new Date(a):new Date(a.setHours(24));return n}function a(){$.each(h.find("table>tbody>tr"),function(e,t){var n=0;$("td>.mns-area-row-"+e).css("height","auto"),$.each($("td>.mns-area-row-"+e),function(e,t){n<$(t).height()&&(n=$(t).height())}),$("td>.mns-area-row-"+e).height(n)})}var o,r,i=$(".miniSheduler"),s=i.find(".mns-toolbar"),d=i.find(".mns-head"),l=d.find(".mns-time-area"),m=i.find(".mns-body"),c=m.find(".mns-resource-area"),h=m.find(".mns-time-area"),f=[{name:"Jose Terronez",data:[{date:new Date,info:"OT201711490"},{date:new Date,info:"OT201711433"},{date:new Date,info:"OT201711666"}]},{name:"Carlos Quispe",data:[{date:new Date("09/07/2017"),info:"OT201751210"}]}],g={mode:"week",info:{monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],dayNamesMin:["D","L","M","X","J","V","S"]}};h.find(".mns-scroller").on("scroll",function(){l.find(".mns-scroller").scrollLeft($(this).scrollLeft())}),s.find(".btnToday").on("click",function(){e()}),s.find(".btnBeforeWeek").on("click",function(){var t=o.Monday;t.setDate(t.getDate()+7),e(t)}),s.find(".btnAfterWeek").on("click",function(){var t=o.Monday;t.setDate(t.getDate()-7),e(t)}),s.find(".btnChangeView").on("click",function(){var n=$(this);s.find(".btnChangeView").removeClass("active"),n.addClass("active"),n.hasClass("btnMonthViewMode")?r="month":n.hasClass("btnWeekViewMode")&&(r="week"),e(),t()}),$("body").on("click",".time-area-item",function(){var e=$(this).attr("id");console.log(f[e.split("-")[3]].data[e.split("-")[4]])}),window.drag=function(e){e.dataTransfer.setData("textID",e.target.id)},window.drop=function(e){e.preventDefault();var t=e.dataTransfer.getData("textID");$(e.target).hasClass("mns-row")?(e.target.appendChild($("#"+t)[0]),a()):$(e.target).parent().hasClass("mns-row")&&($(e.target).parent()[0].appendChild($("#"+t)[0]),a())},window.allowDrop=function(e){e.preventDefault()},r=g.mode,e(),t()});