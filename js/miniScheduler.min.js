"use strict";var drag,drop,allowDrop;$.fn.extend({miniSheduler:function(t){function n(t){r=s(t);var n="";n+=c.info.monthNamesShort[r[0].getMonth()]+" ",n+=("00"+r[0].getDate()).substr(-2,2)+" ",r[0].getFullYear()!==r[r.length-1].getFullYear()&&(n+=", "+r[0].getFullYear()+" "),n+="- ",r[0].getMonth()!==r[r.length-1].getMonth()&&(n+=c.info.monthNamesShort[r[r.length-1].getMonth()]+" "),n+=("00"+r[r.length-1].getDate()).substr(-2,2)+" ",n+=", "+r[r.length-1].getFullYear()+" ",g.find("th.mns-year>.mns-year-content").html(n);var e=159*r.length+1;u.find(".mns-content").css({"min-width":e}),p.find(".mns-content").css({"min-width":e}),u.find(".mns-content>table>colgroup").html(""),u.find(".mns-content>table>thead>tr:eq(0)").html(""),p.find(".mns-content>.mns-rows colgroup").html("");for(var a=100/r.length,o=0;o<r.length;o++)u.find(".mns-content>table>colgroup").append('<col style="width: '+a+'%">'),u.find(".mns-content>table>thead>tr:eq(0)").append('<th class="mns-days">\n                                                                                            <div class="mns-day"></div>\n                                                                                        </th>'),p.find(".mns-content>.mns-rows colgroup").append('<col style="width: '+a+'%">');$.each(g.find("th.mns-days"),function(t,e){n=c.info.dayNames[r[t].getDay()]+" "+("00"+r[t].getDate()).substr(-2,2)+"/"+c.info.monthNamesShort[r[t].getMonth()],$(e).find(".mns-day").html(n)})}function e(t){$.ajax({url:l+"?start="+r[0].getFullYear()+"-"+(r[0].getMonth()+1)+"-"+r[0].getDate()+"&end="+r[r.length-1].getFullYear()+"-"+(r[r.length-1].getMonth()+1)+"-"+r[r.length-1].getDate()+(t||""),type:"GET",dataType:"json",success:function(t){d=t,a()}})}function a(){f.find("table>tbody").html(""),p.find("table>tbody").html(""),$.each(d,function(t,n){var e=$("<tr>");f.find("table>tbody").append('<tr>\n                                                                        <td>\n                                                                            <div class="mns-row mns-area-row-'+t+'">\n                                                                                '+n.name+"\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>");for(var a=0;a<r.length;a++){var s,o;!function(a){s=$("<td>"),o=$('<div class="mns-row mns-area-row-'+t+'" '+(c.draggable?'ondrop="drop(event)" ondragover="allowDrop(event)"':"")+">"),$.each(n.data,function(n,e){var s=new Date(e.date);r[a].getDate()===s.getDate()&&r[a].getMonth()===s.getMonth()&&r[a].getFullYear()===s.getFullYear()&&o.append("<div class='time-area-item' id='time-area-item-"+t+"-"+n+"' "+(c.draggable?'draggable="true" ondragstart="drag(event)"':"")+">"+e.info+"</div>")}),s.append(o),n.footer&&$.each(n.footer,function(t,n){var e=new Date(n.date);if(r[a].getDate()===e.getDate()&&r[a].getMonth()===e.getMonth()&&r[a].getFullYear()===e.getFullYear()){var o=$('<div class="mns-row-pie">'+n.contend+"</div>");n.background&&o.css({background:n.background}),n.color&&o.css({color:n.color}),s.append(o)}}),e.append(s)}(a)}p.find("table>tbody").append(e)}),o()}function s(t){var n,e=[],a=t?new Date(t):new Date(new Date);if("month"===i)n=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),1!==a.getDate()&&a.setDate(1);else{n=7;var s=a.getDay()||7;1!==s&&a.setHours(-24*(s-1))}for(var o=0;o<n;o++)e[o]=0===o?new Date(a):new Date(a.setHours(24));return e}function o(){$.each(p.find("table>tbody>tr"),function(t,n){var e=0;$("td>.mns-area-row-"+t).css("height","auto"),$.each($("td>.mns-area-row-"+t),function(t,n){e<$(n).parent().height()&&(e=$(n).parent().height()),$(n).css("height",0!==$(n).next(".mns-row-pie").length?"calc(100% - 25px)":"100%")}),$("td>.mns-area-row-"+t).parent().height(e)})}var r,i,l,d=[],c={mode:"week",info:{monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],dayNamesMin:["D","L","M","X","J","V","S"]},draggable:!1},m=$(this).addClass("miniSheduler"),h=$('<div class="mns-toolbar">\n                                    <div class="mns-left">\n                                        <button type="button" class="mns-btn btnToday">Hoy</button>\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnAfterWeek"><i class="mns-arrow-left"></i></button>\n                                            <button type="button" class="mns-btn btnBeforeWeek"><i class="mns-arrow-right"></i></button>\n                                        </div>\n                                    </div>\n                                    <div class="mns-center"></div>\n                                    <div class="mns-right">\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnChangeView btnWeekViewMode active">Semana</button>\n                                            <button type="button" class="mns-btn btnChangeView btnMonthViewMode">Mes</button>\n                                        </div>\n                                    </div>\n                                </div>').appendTo(m),b=$('<div class="mns-container">\n                                    <div class="mns-container-view mns-timelineWeek mns-timeline">\n                                        <table class="table table-bordered">\n                                        <colgroup>\n                                            <col>\n                                            <col>\n                                            <col>\n                                        </colgroup>\n                                        <thead class="mns-head">\n                                        <tr>\n                                            <th class="mns-resource-area">\n                                                <i class="fa fa-user" aria-hidden="true"></i> Tecnico\n                                            </th>\n                                            <th class="mns-divider mns-col-resizer"></th>\n                                            <th class="mns-time-area">\n                                                <table class="table table-bordered">\n                                                    <thead>\n                                                    <tr>\n                                                        <th class="mns-year">\n                                                            <div class="mns-year-content"></div>\n                                                        </th>\n                                                    </tr>\n                                                    </thead>\n                                                </table>\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <table class="table table-bordered">\n                                                                <colgroup></colgroup>\n                                                                <thead><tr></tr></thead>\n                                                            </table>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </th>\n                                        </tr>\n                                        </thead>\n                                        <tbody class="mns-body">\n                                        <tr>\n                                            <td class="mns-resource-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                            <td class="mns-divider mns-col-resizer"></td>\n                                            <td class="mns-time-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <colgroup></colgroup>\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                        </table>\n                                    </div>\n                                </div>').appendTo(m),g=b.find(".mns-head"),u=g.find(".mns-time-area"),v=b.find(".mns-body"),f=v.find(".mns-resource-area"),p=v.find(".mns-time-area");return p.find(".mns-scroller").on("scroll",function(){u.find(".mns-scroller").scrollLeft($(this).scrollLeft())}),h.find(".btnToday").on("click",function(){n(),e(),a()}),h.find(".btnBeforeWeek").on("click",function(){var t=r[0];"month"===i?t.setMonth(t.getMonth()+1):t.setDate(t.getDate()+7),n(t),e(),a()}),h.find(".btnAfterWeek").on("click",function(){var t=r[0];"month"===i?t.setMonth(t.getMonth()-1):t.setDate(t.getDate()-7),n(t),e(),a()}),h.find(".btnChangeView").on("click",function(){var t=$(this);t.hasClass("active")||(h.find(".btnChangeView").removeClass("active"),t.addClass("active"),t.hasClass("btnMonthViewMode")?i="month":t.hasClass("btnWeekViewMode")&&(i="week"),n(),e(),a())}),$("body").on("click",".time-area-item",function(){var t=$(this).attr("id"),n=t.split("-")[3],e=t.split("-")[4],a={name:d[n].name,extra:d[n].extra,item:d[n].data[e]};c.onClick&&c.onClick(a)}),$(document).on("mouseenter",".time-area-item",function(t){var n=$(this),e=$(this).attr("id"),a=e.split("-")[3],s=e.split("-")[4],o={name:d[a].name,extra:d[a].extra,item:d[a].data[s]};if(c.tooltip){var r=n.position();$("<div class='mns-tooltip'>").css({left:r.left+(n.width()-150)/2+"px",top:r.top+17+8+"px"}).html(c.tooltip.content(o)).appendTo(document.body)}}),$(document).on("mouseleave",".time-area-item",function(t){$(".mns-tooltip").remove()}),window.drag=function(t){t.dataTransfer.setData("textID",t.target.id)},window.drop=function(t){t.preventDefault();var n=t.dataTransfer.getData("textID");$(t.target).hasClass("mns-row")?(t.target.appendChild($("#"+n)[0]),o()):$(t.target).parent().hasClass("mns-row")&&($(t.target).parent()[0].appendChild($("#"+n)[0]),o())},window.allowDrop=function(t){t.preventDefault()},i=c.mode,n(),t.ajax.data?d=t.ajax.data:t.ajax.url&&0!==t.ajax.url.length&&(l=t.ajax.url,e()),t.icons&&t.icons.arrow&&(h.find("i.mns-arrow-left").attr("class",t.icons.arrow.left),h.find("i.mns-arrow-right").attr("class",t.icons.arrow.right)),c.draggable=t.draggable,c.onClick=t.onClick,c.tooltip=t.tooltip,a(),{destroy:function(){m.html("")},load:{data:function(t){d=t,a()},update:function(t){e(t)}}}}});