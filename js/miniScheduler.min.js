"use strict";var drag,drop,allowDrop;$.fn.extend({miniSheduler:function(n){function t(n){r=s(n);var t="";t+=c.info.monthNamesShort[r[0].getMonth()]+" ",t+=("00"+r[0].getDate()).substr(-2,2)+" ",r[0].getFullYear()!==r[r.length-1].getFullYear()&&(t+=", "+r[0].getFullYear()+" "),t+="- ",r[0].getMonth()!==r[r.length-1].getMonth()&&(t+=c.info.monthNamesShort[r[r.length-1].getMonth()]+" "),t+=("00"+r[r.length-1].getDate()).substr(-2,2)+" ",t+=", "+r[r.length-1].getFullYear()+" ",b.find("th.mns-year>.mns-year-content").html(t);var e=159*r.length+1;u.find(".mns-content").css({"min-width":e}),p.find(".mns-content").css({"min-width":e}),u.find(".mns-content>table>colgroup").html(""),u.find(".mns-content>table>thead>tr:eq(0)").html(""),p.find(".mns-content>.mns-rows colgroup").html("");for(var a=100/r.length,o=0;o<r.length;o++)u.find(".mns-content>table>colgroup").append('<col style="width: '+a+'%">'),u.find(".mns-content>table>thead>tr:eq(0)").append('<th class="mns-days">\n                                                                                            <div class="mns-day"></div>\n                                                                                        </th>'),p.find(".mns-content>.mns-rows colgroup").append('<col style="width: '+a+'%">');$.each(b.find("th.mns-days"),function(n,e){t=c.info.dayNames[r[n].getDay()]+" "+("00"+r[n].getDate()).substr(-2,2)+"/"+c.info.monthNamesShort[r[n].getMonth()],$(e).find(".mns-day").html(t)})}function e(n){$.ajax({url:l+"?start="+r[0].getFullYear()+"-"+(r[0].getMonth()+1)+"-"+r[0].getDate()+"&end="+r[r.length-1].getFullYear()+"-"+(r[r.length-1].getMonth()+1)+"-"+r[r.length-1].getDate()+(n||""),type:"GET",dataType:"json",success:function(n){d=n,a()}})}function a(){f.find("table>tbody").html(""),p.find("table>tbody").html(""),$.each(d,function(n,t){var e=$("<tr>");f.find("table>tbody").append('<tr>\n                                                                        <td>\n                                                                            <div class="mns-row mns-area-row-'+n+'">\n                                                                                '+t.name+"\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>");for(var a=0;a<r.length;a++){var s,o;!function(a){s=$("<td>"),o=$('<div class="mns-row mns-area-row-'+n+'" '+(c.draggable?'ondrop="drop(event)" ondragover="allowDrop(event)"':"")+">"),$.each(t.data,function(t,e){var s=new Date(e.date);r[a].getDate()===s.getDate()&&r[a].getMonth()===s.getMonth()&&r[a].getFullYear()===s.getFullYear()&&o.append("<div class='time-area-item' id='time-area-item-"+n+"-"+t+"' "+(c.draggable?'draggable="true" ondragstart="drag(event)"':"")+">"+e.info+"</div>")}),s.append(o),t.footer&&$.each(t.footer,function(n,t){var e=new Date(t.date);if(r[a].getDate()===e.getDate()&&r[a].getMonth()===e.getMonth()&&r[a].getFullYear()===e.getFullYear()){var o=$('<div class="mns-row-pie">'+t.contend+"</div>");t.background&&o.css({background:t.background}),t.color&&o.css({color:t.color}),s.append(o)}}),e.append(s)}(a)}p.find("table>tbody").append(e)}),o()}function s(n){var t,e=[],a=n?new Date(n):new Date(new Date);if("month"===i)t=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),1!==a.getDate()&&a.setDate(1);else{t=7;var s=a.getDay()||7;1!==s&&a.setHours(-24*(s-1))}for(var o=0;o<t;o++)e[o]=0===o?new Date(a):new Date(a.setHours(24));return e}function o(){$.each(p.find("table>tbody>tr"),function(n,t){var e=0;$("td>.mns-area-row-"+n).css("height","auto"),$.each($("td>.mns-area-row-"+n),function(n,t){e<$(t).parent().height()&&(e=$(t).parent().height()),$(t).css("height",0!==$(t).next(".mns-row-pie").length?"calc(100% - 25px)":"100%")}),$("td>.mns-area-row-"+n).parent().height(e)})}var r,i,l,d=[],c={mode:"week",info:{monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],dayNamesMin:["D","L","M","X","J","V","S"]},draggable:!1},m=$(this).addClass("miniSheduler"),h=$('<div class="mns-toolbar">\n                                    <div class="mns-left">\n                                        <button type="button" class="mns-btn btnToday">Hoy</button>\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnAfterWeek"><i class="mns-arrow-left"></i></button>\n                                            <button type="button" class="mns-btn btnBeforeWeek"><i class="mns-arrow-right"></i></button>\n                                        </div>\n                                    </div>\n                                    <div class="mns-center"></div>\n                                    <div class="mns-right">\n                                        <div class="mns-btn-group">\n                                            <button type="button" class="mns-btn btnChangeView btnWeekViewMode active">Semana</button>\n                                            <button type="button" class="mns-btn btnChangeView btnMonthViewMode">Mes</button>\n                                        </div>\n                                    </div>\n                                </div>').appendTo(m),g=$('<div class="mns-container">\n                                    <div class="mns-container-view mns-timelineWeek mns-timeline">\n                                        <table class="table table-bordered">\n                                        <colgroup>\n                                            <col>\n                                            <col>\n                                            <col>\n                                        </colgroup>\n                                        <thead class="mns-head">\n                                        <tr>\n                                            <th class="mns-resource-area">\n                                                <i class="fa fa-user" aria-hidden="true"></i> Tecnico\n                                            </th>\n                                            <th class="mns-divider mns-col-resizer"></th>\n                                            <th class="mns-time-area">\n                                                <table class="table table-bordered">\n                                                    <thead>\n                                                    <tr>\n                                                        <th class="mns-year">\n                                                            <div class="mns-year-content"></div>\n                                                        </th>\n                                                    </tr>\n                                                    </thead>\n                                                </table>\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <table class="table table-bordered">\n                                                                <colgroup></colgroup>\n                                                                <thead><tr></tr></thead>\n                                                            </table>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </th>\n                                        </tr>\n                                        </thead>\n                                        <tbody class="mns-body">\n                                        <tr>\n                                            <td class="mns-resource-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                            <td class="mns-divider mns-col-resizer"></td>\n                                            <td class="mns-time-area">\n                                                <div class="mns-scroller">\n                                                    <div class="mns-scroller-inner">\n                                                        <div class="mns-content">\n                                                            <div class="mns-rows">\n                                                                <table class="table table-bordered">\n                                                                    <colgroup></colgroup>\n                                                                    <tbody></tbody>\n                                                                </table>\n                                                            </div>\n                                                            <div class="mns-pie"></div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                        </table>\n                                    </div>\n                                </div>').appendTo(m),b=g.find(".mns-head"),u=b.find(".mns-time-area"),v=g.find(".mns-body"),f=v.find(".mns-resource-area"),p=v.find(".mns-time-area");return p.find(".mns-scroller").on("scroll",function(){u.find(".mns-scroller").scrollLeft($(this).scrollLeft())}),h.find(".btnToday").on("click",function(){t(),e(),a()}),h.find(".btnBeforeWeek").on("click",function(){var n=r[0];"month"===i?n.setMonth(n.getMonth()+1):n.setDate(n.getDate()+7),t(n),e(),a()}),h.find(".btnAfterWeek").on("click",function(){var n=r[0];"month"===i?n.setMonth(n.getMonth()-1):n.setDate(n.getDate()-7),t(n),e(),a()}),h.find(".btnChangeView").on("click",function(){var n=$(this);n.hasClass("active")||(h.find(".btnChangeView").removeClass("active"),n.addClass("active"),n.hasClass("btnMonthViewMode")?i="month":n.hasClass("btnWeekViewMode")&&(i="week"),t(),e(),a())}),$("body").on("click",".time-area-item",function(){var n=$(this).attr("id"),t=n.split("-")[3],e=n.split("-")[4],a={name:d[t].name,extra:d[t].extra,item:d[t].data[e]};c.onClick&&c.onClick(a)}),window.drag=function(n){n.dataTransfer.setData("textID",n.target.id)},window.drop=function(n){n.preventDefault();var t=n.dataTransfer.getData("textID");$(n.target).hasClass("mns-row")?(n.target.appendChild($("#"+t)[0]),o()):$(n.target).parent().hasClass("mns-row")&&($(n.target).parent()[0].appendChild($("#"+t)[0]),o())},window.allowDrop=function(n){n.preventDefault()},i=c.mode,t(),n.ajax.data?d=n.ajax.data:n.ajax.url&&0!==n.ajax.url.length&&(l=n.ajax.url,e()),n.icons&&n.icons.arrow&&(h.find("i.mns-arrow-left").attr("class",n.icons.arrow.left),h.find("i.mns-arrow-right").attr("class",n.icons.arrow.right)),c.draggable=n.draggable,c.onClick=n.onClick,a(),{destroy:function(){m.html("")},load:{data:function(n){d=n,a()},update:function(n){e(n)}}}}});